<server description="fhir-server">
    <!-- 
        This configDropin work with Db2 and user-password
    -->
    <featureManager>
        <feature>batchManagement-1.0</feature>
        <feature>jdbc-4.1</feature>
        <feature>servlet-4.0</feature>
        <feature>transportSecurity-1.0</feature>
    </featureManager>

    <authorization-roles id="com.ibm.ws.batch">
        <security-role id="batchAdmin" name="batchAdmin">
            <user id="batchAdminUser" name="fhiradmin"/>
        </security-role>
        <security-role id="batchSubmitter" name="batchSubmitter">
            <user id="batchSubmitterUser" name="fhiruser"/>
        </security-role>
        <security-role id="batchMonitor" name="batchMonitor">
            <user id="batchMonitorUser1" name="fhiradmin"/>
            <user id="batchMonitorUser2" name="fhiruser"/>
        </security-role>
    </authorization-roles>

    <webApplication id="fhir-bulkimportexport-webapp" location="fhir-bulkimportexport.war" name="fhir-bulkimportexport-webapp">
        <classloader commonLibraryRef="fhirSharedLib" privateLibraryRef="configResources,fhirUserLib"/>
        <application-bnd>
            <security-role id="users" name="FHIRUsers">
                <group id="bulkUsersGroup" name="FHIRUsers"/>
            </security-role>
        </application-bnd>
    </webApplication>

    <variable name="BATCH_DB_NAME_DS" value="${env.BATCH_DB_NAME}" defaultValue="FHIRDB"/>
    <variable name="BATCH_DB_SCHEMA_DS" value="${env.BATCH_DB_SCHEMA}" defaultValue="FHIR_JBATCH"/>
    <variable name="BATCH_DB_PORT_DS" value="${env.BATCH_DB_PORT}" defaultValue="50000"/>
    <variable name="BATCH_DB_USER_DS" value="${env.BATCH_DB_USER}" defaultValue="db2inst1"/>
    <variable name="BATCH_DB_PASS_DS" value="${env.BATCH_DB_PASS}" defaultValue=""/>
    <variable name="BATCH_DB_SSL_DS" value="${env.BATCH_DB_SSL}" defaultValue="true"/>

    <dataSource id="fhirbatchDS" jndiName="jdbc/fhirbatchDB">
        <jdbcDriver libraryRef="fhirSharedLib"/>
        <properties.db2.jcc
            serverName="${env.BATCH_DB_HOSTNAME}"
            currentSchema="${BATCH_DB_SCHEMA_DS}"
            databaseName="${BATCH_DB_NAME_DS}"
            driverType="4"
            portNumber="${BATCH_DB_PORT_DS}"
            sslConnection="${BATCH_DB_SSL_DS}"
            user="${BATCH_DB_USER_DS}"
            password="${BATCH_DB_PASS_DS}" />
    </dataSource>

   <batchPersistence jobStoreRef="BatchDatabaseStore"/>
   <databaseStore dataSourceRef="fhirbatchDS" id="BatchDatabaseStore" schema="${BATCH_DB_SCHEMA}" tablePrefix="" createTables="false"/>
</server>
